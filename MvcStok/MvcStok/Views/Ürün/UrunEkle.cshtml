@model MvcStok.Models.Entity.TBLURUNLER
@{
    ViewBag.Title = "UrunEkle";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

namespace MvcStok.Controllers
{
    public class ÜrünController : Controller
    {
        // GET: Ürün
        MvcDBStokEntities db = new MvcDBStokEntities();
        public ActionResult Index()
        {
            var degerler = db.TBLURUNLER.ToList();
            return View(degerler);
        }
        [HttpGet]
        public ActionResult UrunEkle()
        {
            List<SelectListItem>
    degerler = (from i in db.TBLKATEGORILER.ToList()
    select new SelectListItem
    {
    Text = i.KATEGORIAD,
    Value = i.KATEGORIID.ToString()
    }).ToList();
    ViewBag.dgr = degerler;
    return View();
    }
    [HttpPost]
    public ActionResult UrunEkle(TBLURUNLER p1)
    {
    var ktg = db.TBLKATEGORILER.Where(m=> m.KATEGORIID == p1.TBLKATEGORILER.KATEGORIID).FirstOrDefault();
    p1.TBLKATEGORILER = ktg;
    db.TBLURUNLER.Add(p1);
    db.SaveChanges();
    return RedirectToAction("Index");
    }
    public ActionResult SIL(int id)
    {
    var urun = db.TBLURUNLER.Find(id);
    db.TBLURUNLER.Remove(urun);
    db.SaveChanges();
    return RedirectToAction("Index");
    }
    public ActionResult UrunGetir(int id)
    {

    var urun = db.TBLURUNLER.Find(id);

    List<SelectListItem>
        degerler = (from i in db.TBLKATEGORILER.ToList()
        select new SelectListItem
        {
        Text = i.KATEGORIAD,
        Value = i.KATEGORIID.ToString()
        }).ToList();
        ViewBag.dgr = degerler;

        return View("UrunGetir", urun);
        }
        public ActionResult Guncelle(TBLURUNLER p)
        {
        var urun = db.TBLURUNLER.Find(p.URUNID);
        urun.URUNADI = p.URUNADI;
        urun.MARKA = p.MARKA;
        urun.STOK = p.STOK;
        urun.FIYAT = p.FIYAT;
        //urun.URUNKATEGORI = p.URUNKATEGORI;
        var ktg = db.TBLKATEGORILER.Where(m => m.KATEGORIID == p.TBLKATEGORILER.KATEGORIID).FirstOrDefault();
        urun.URUNKATEGORI = ktg.KATEGORIID;
        db.SaveChanges();
        return RedirectToAction("Index");
        }

        }
        }

